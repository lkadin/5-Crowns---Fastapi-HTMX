<div id="table" class="col-8">
    {% include './draw_card.html' %}
</div>

<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const list = document.getElementById('listForSorting');
        if (!list) {
            console.error('Sortable container not found');
            return;
        }

        Sortable.create(list, {
            animation: 150,
            draggable: '.card',
            onEnd: function(evt) {
                const cards = Array.from(list.children).map(card => {
                    return card.getAttribute('data-card-id');
                });

                fetch('/manual_sort', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_id: document.querySelector('[data-user-id]')?.getAttribute('data-user-id'),
                        newOrder: cards
                    })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.status !== 'success') {
                        console.error('Sort failed:', data.message);
                    }
                })
                .catch(error => console.error('Error:', error));
            }
        });
    });
</script>