<!DOCTYPE html>
<html lang="en">

<head>
    <title>5 Crowns - {{user_name}}</title>
</head>

<script src="https://unpkg.com/htmx.org@1.9.4"></script>
<script src="https://unpkg.com/htmx.org/dist/ext/ws.js"></script>
<script src="https://unpkg.com/htmx.org/dist/ext/debug.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
<link href="/static/css/site.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>

<body>
    <div class="container-fluid">
        <div hx-ws="connect:/ws/{{user_id}}">
            <div class="row">
                {% include './notifications.html' %}
                {% include './table.html' %}
            </div>
        </div>
    </div>
    <script>
        function initSortable() {
            var sortableEl = document.getElementById('card-container');
            if (sortableEl) {
                new Sortable(sortableEl, {
                    animation: 150,
                    onEnd: function (evt) {
                        var card_order = Array.from(evt.to.children).map(function(child) {
                            return child.dataset.card;
                        }).filter(function(item) {
                            return item !== undefined;
                        });

                        if (card_order.length > 0) {
                            var ws = htmx.find(document.body).webSocket;
                            if (ws) {
                                ws.send(JSON.stringify({
                                    "action": "sort_cards",
                                    "order": card_order
                                }));
                            }
                        }
                    }
                });
            }
        }
    </script>
</body>

</html>